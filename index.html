<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Substation & Dashboard</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
            color: #333;
            transition: background-color 0.5s ease-in-out, color 0.5s ease-in-out;
        }
        .container {
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .hidden {
            display: none;
        }
        .button-container {
            text-align: center;
            margin-top: 30px;
        }
        .button {
            padding: 12px 24px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            text-decoration: none;
            transition: background-color 0.3s;
        }
        .button:hover {
            background-color: #0056b3;
        }
    </style>

    <style>
        #digital-twin-page h2 {
            margin-bottom: 30px;
            text-align: center;
        }
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        .legend-item {
            display: flex;
            align-items: center;
        }
        .legend-item-box {
            width: 20px;
            height: 20px;
            margin-right: 8px;
            border: 1px solid #000;
        }
        #map-container {
            width: 800px;
            height: 500px;
            border: 2px solid #ccc;
            background-color: #fff;
            position: relative;
            margin: 0 auto;
        }
        .asset {
            position: absolute;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 12px;
            border: 2px solid;
            transition: all 0.5s ease-in-out;
            cursor: pointer;
        }
        .digital-twin {
            position: absolute;
            width: 120px;
            height: 120px;
            border: 3px dashed #007BFF;
            background-color: rgba(0, 123, 255, 0.1);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #007BFF;
            text-align: center;
        }
        .link {
            position: absolute;
            border-bottom: 2px dashed;
            transform-origin: 0 0;
            transition: border-color 0.5s ease-in-out, transform 0.5s ease-in-out;
        }
        .connected-line { border-color: #28a745; }
        .unauthorized-line { border-color: #dc3545; }
        .connected { background-color: #d4edda; border-color: #28a745; }
        .unauthorized { background-color: #f8d7da; border-color: #dc3545; }
        .unauthenticated { background-color: #ffc107; border-color: #ffc107; }
        .asset-label {
            position: absolute;
            font-size: 10px;
            font-weight: bold;
            text-align: center;
            width: 100px;
        }
    </style>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        .dashboard-styles body {
            background-color: #1a202c;
            color: #e2e8f0;
        }
        .card {
            background-color: #2d3748;
            border: 1px solid #4a5568;
        }
        .grid-container {
            display: grid;
            gap: 1.5rem;
            grid-template-columns: repeat(1, minmax(0, 1fr));
        }
        @media (min-width: 768px) {
            .grid-container {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }
        }
        @media (min-width: 1024px) {
            .grid-container {
                grid-template-columns: repeat(3, minmax(0, 1fr));
            }
        }
    </style>
</head>
<body>

    <div id="digital-twin-page" class="container">
        <h2>Secure Digital Twin for EHV Substation</h2>
        <div class="legend">
            <div class="legend-item"><div class="legend-item-box" style="background-color: #d4edda; border-color: #28a745;"></div>Authenticated Asset</div>
            <div class="legend-item"><div class="legend-item-box" style="background-color: #f8d7da; border-color: #dc3545;"></div>Unauthorized Asset</div>
        </div>
        <div id="map-container">
            <div id="asset-1" class="asset unauthenticated" style="top: 10%; left: 15%;">Transformer</div>
            <div id="asset-2" class="asset unauthenticated" style="top: 30%; left: 70%;">Circuit Breaker</div>
            <div id="asset-3" class="asset unauthorized" style="top: 80%; left: 30%;">Malicious Device</div>
            <div class="digital-twin">Digital Twin Core</div>
        </div>
        <div class="button-container">
            <button class="button" onclick="showDashboard()">View Live Dashboard</button>
        </div>
    </div>

    <div id="dashboard-page" class="hidden container">
        <div class="max-w-7xl mx-auto">
            <div class="mb-8">
                <h1 class="text-3xl md:text-4xl font-bold text-center" style="color: white;">Substation Monitoring Dashboard</h1>
                <p class="text-center text-sm md:text-lg text-gray-400 mt-2">Real-time data visualization of key metrics.</p>
            </div>
            <div class="grid-container">
                <div class="card p-6 rounded-xl shadow-lg flex flex-col items-center justify-center">
                    <div class="text-4xl md:text-5xl font-bold text-green-400" id="voltage">240.5 kV</div>
                    <p class="text-gray-400 mt-2">Main Voltage</p>
                    <div class="mt-4 w-full h-2 bg-gray-600 rounded-full">
                        <div class="h-full bg-green-500 rounded-full" style="width: 80%;"></div>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">Status: Stable</p>
                </div>
                <div class="card p-6 rounded-xl shadow-lg flex flex-col items-center justify-center">
                    <div class="text-4xl md:text-5xl font-bold text-blue-400" id="current">125.8 A</div>
                    <p class="text-gray-400 mt-2">Current Flow</p>
                    <div class="mt-4 w-full h-2 bg-gray-600 rounded-full">
                        <div class="h-full bg-blue-500 rounded-full" style="width: 65%;"></div>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">Status: Normal</p>
                </div>
                <div class="card p-6 rounded-xl shadow-lg flex flex-col items-center justify-center">
                    <div class="text-4xl md:text-5xl font-bold text-yellow-400" id="temperature">45.2 °C</div>
                    <p class="text-gray-400 mt-2">Transformer Temp</p>
                    <div class="mt-4 w-full h-2 bg-gray-600 rounded-full">
                        <div class="h-full bg-yellow-500 rounded-full" style="width: 50%;"></div>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">Status: Elevated</p>
                </div>
                <div class="card p-6 rounded-xl shadow-lg">
                    <h3 class="text-xl font-semibold mb-4 text-center">Circuit Breaker Status</h3>
                    <ul class="space-y-4">
                        <li class="flex justify-between items-center bg-gray-700 p-3 rounded-md">
                            <span>Breaker A-1</span>
                            <span class="text-green-400 font-bold">ON</span>
                        </li>
                        <li class="flex justify-between items-center bg-gray-700 p-3 rounded-md">
                            <span>Breaker B-2</span>
                            <span class="text-green-400 font-bold">ON</span>
                        </li>
                        <li class="flex justify-between items-center bg-gray-700 p-3 rounded-md">
                            <span>Breaker C-3</span>
                            <span class="text-red-400 font-bold" id="breaker-c3">OFF</span>
                        </li>
                    </ul>
                </div>
                <div class="card p-6 rounded-xl shadow-lg flex flex-col items-center justify-center">
                    <div class="text-4xl md:text-5xl font-bold text-purple-400" id="power-factor">0.95</div>
                    <p class="text-gray-400 mt-2">Power Factor</p>
                    <div class="mt-4 w-full h-2 bg-gray-600 rounded-full">
                        <div class="h-full bg-purple-500 rounded-full" style="width: 95%;"></div>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">Status: Excellent</p>
                </div>
                <div class="card p-6 rounded-xl shadow-lg">
                    <h3 class="text-xl font-semibold mb-4 text-center">Alerts & Events</h3>
                    <ul class="space-y-2 text-sm text-gray-400" id="event-log">
                        <li><span class="text-red-400 font-bold">[ALERT]</span> Breaker C-3 tripped at 10:35 AM.</li>
                        <li><span class="text-yellow-400 font-bold">[WARN]</span> Temp approaching threshold.</li>
                        <li><span class="text-green-400 font-bold">[INFO]</span> System check completed.</li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="button-container">
            <button class="button" onclick="showDigitalTwin()">Back</button>
        </div>
    </div>

    <script>
        // Page Navigation Logic
        const digitalTwinPage = document.getElementById('digital-twin-page');
        const dashboardPage = document.getElementById('dashboard-page');
        let dashboardIntervalId;
        let digitalTwinIntervalId;

        function showDashboard() {
            digitalTwinPage.classList.add('hidden');
            dashboardPage.classList.remove('hidden');
            document.body.style.backgroundColor = '#1a202c';
            document.body.style.color = '#e2e8f0';
            
            clearInterval(digitalTwinIntervalId);
            updateDashboard();
            dashboardIntervalId = setInterval(updateDashboard, 3000);
        }

        function showDigitalTwin() {
            dashboardPage.classList.add('hidden');
            digitalTwinPage.classList.remove('hidden');
            document.body.style.backgroundColor = '#f0f0f0';
            document.body.style.color = '#333';
            
            clearInterval(dashboardIntervalId);
            runDigitalTwinSimulation();
        }

        // Digital Twin Map Logic
        const mapContainer = document.getElementById('map-container');
        const twinCore = { x: 50, y: 50 };
        const assets = [
            { id: 'asset-1', status: 'connected', x: 15, y: 10 },
            { id: 'asset-2', status: 'connected', x: 70, y: 30 },
            { id: 'asset-3', status: 'unauthorized', x: 30, y: 80 }
        ];

        function createLink(fromX, fromY, toX, toY, className) {
            const containerRect = mapContainer.getBoundingClientRect();
            fromX = fromX * (containerRect.width / 100);
            fromY = fromY * (containerRect.height / 100);
            toX = toX * (containerRect.width / 100);
            toY = toY * (containerRect.height / 100);

            const dx = toX - fromX;
            const dy = toY - fromY;
            const length = Math.sqrt(dx * dx + dy * dy);
            const angle = Math.atan2(dy, dx) * 180 / Math.PI;

            const link = document.createElement('div');
            link.className = `link ${className}`;
            link.style.width = `${length}px`;
            link.style.top = `${fromY}px`;
            link.style.left = `${fromX}px`;
            link.style.transform = `rotate(${angle}deg)`;
            mapContainer.appendChild(link);
        }

        function runDigitalTwinSimulation() {
            let currentAssetIndex = 0;
            digitalTwinIntervalId = setInterval(() => {
                if (currentAssetIndex >= assets.length) {
                    clearInterval(digitalTwinIntervalId);
                    return;
                }

                const asset = assets[currentAssetIndex];
                const assetElement = document.getElementById(asset.id);
                if (!assetElement) {
                    currentAssetIndex++;
                    return;
                }
                
                // Clear any existing links and reset asset positions
                const links = mapContainer.querySelectorAll('.link');
                links.forEach(link => link.remove());
                assets.forEach(a => {
                    const el = document.getElementById(a.id);
                    if(el) {
                        el.style.top = `${a.y}%`;
                        el.style.left = `${a.x}%`;
                        el.classList.remove('connected', 'unauthorized');
                        el.classList.add('unauthenticated');
                    }
                });

                // Simulate connection attempt
                assetElement.style.top = `${twinCore.y}%`;
                assetElement.style.left = `${twinCore.x}%`;
                
                setTimeout(() => {
                    if (asset.status === 'connected') {
                        assetElement.classList.remove('unauthenticated');
                        assetElement.classList.add('connected');
                        createLink(asset.x, asset.y, twinCore.x, twinCore.y, 'connected-line');
                    } else {
                        assetElement.classList.remove('unauthenticated');
                        assetElement.classList.add('unauthorized');
                        createLink(asset.x, asset.y, twinCore.x, twinCore.y, 'unauthorized-line');
                    }
                    
                    setTimeout(() => {
                        assetElement.style.top = `${asset.y}%`;
                        assetElement.style.left = `${asset.x}%`;
                    }, 500);

                }, 1000);
                currentAssetIndex++;
            }, 2000);
        }

        // Live Dashboard Data Logic
        function updateDashboard() {
            const voltageEl = document.getElementById('voltage');
            const currentEl = document.getElementById('current');
            const temperatureEl = document.getElementById('temperature');
            const breakerC3El = document.getElementById('breaker-c3');
            const powerFactorEl = document.getElementById('power-factor');
            const eventLogEl = document.getElementById('event-log');

            if (!voltageEl) return;

            const newVoltage = (235 + Math.random() * 10).toFixed(1);
            const newCurrent = (120 + Math.random() * 10).toFixed(1);
            const newTemperature = (40 + Math.random() * 10).toFixed(1);
            const newPowerFactor = (0.90 + Math.random() * 0.1).toFixed(2);
            const breakerStatus = Math.random() < 0.95 ? 'ON' : 'OFF';

            voltageEl.innerText = `${newVoltage} kV`;
            currentEl.innerText = `${newCurrent} A`;
            temperatureEl.innerText = `${newTemperature} °C`;
            powerFactorEl.innerText = newPowerFactor;
            breakerC3El.innerText = breakerStatus;
            breakerC3El.classList.toggle('text-green-400', breakerStatus === 'ON');
            breakerC3El.classList.toggle('text-red-400', breakerStatus === 'OFF');

            if (breakerStatus === 'OFF') {
                const newEvent = document.createElement('li');
                newEvent.innerHTML = `<span class="text-red-400 font-bold">[ALERT]</span> Breaker C-3 tripped at ${new Date().toLocaleTimeString()}.`;
                eventLogEl.prepend(newEvent);
                if (eventLogEl.children.length > 5) {
                    eventLogEl.removeChild(eventLogEl.lastChild);
                }
            }
        }
        
        window.onload = showDigitalTwin;
    </script>
</body>
</html>
